# AI-Enhanced Vulnerability Detection System

A comprehensive system for detecting, analyzing, and visualizing security vulnerabilities in Web3 applications and smart contracts using machine learning techniques.

## Overview

The AI-Enhanced Vulnerability Detection System combines traditional security testing approaches with machine learning to provide advanced vulnerability detection capabilities. The system is designed with a modular architecture to allow for easy integration with existing projects.

### Key Features

- **Pattern-Based Detection**: Identifies known vulnerability patterns in smart contracts
- **ML-Powered Classification**: Uses machine learning models to classify and detect vulnerabilities
- **Test Integration**: Seamlessly integrates with testing frameworks for continuous security testing
- **Data Collection**: Gathers vulnerability data to train and improve detection models
- **Visualization**: Generates comprehensive reports and visualizations for security findings

## System Architecture

The system is divided into five integrated phases:

1. **Data Infrastructure**: Collects and processes vulnerability data
2. **Model Development**: Trains and manages ML models for vulnerability detection
3. **Testing Integration**: Integrates with testing frameworks and pipelines
4. **Advanced Detection**: Applies sophisticated detection techniques for complex vulnerabilities
5. **Visualization**: Provides visual representation of vulnerabilities and security reports

## Installation

```bash
# Clone the repository
git clone https://github.com/your-org/web3-security-test-kit.git

# Install dependencies
cd web3-security-test-kit
npm install
```

## Getting Started

Basic usage of the system:

```javascript
const aiVulnDetection = require('./src/core/ai-vulnerability-detection');

// Initialize the system
await aiVulnDetection.initialize({
  dataStoragePath: './data/vulnerability-data',
});

// Analyze a smart contract
const analysisResult = await aiVulnDetection.analyzeContract({
  contractPath: './contracts/MyContract.sol',
});

// Log results
console.log(`Vulnerabilities found: ${analysisResult.vulnerabilityCount}`);
for (const vuln of analysisResult.vulnerabilities) {
  console.log(`- ${vuln.type} (${vuln.severity}): ${vuln.description}`);
}
```

## Comprehensive Usage

### 1. Initialize the System

```javascript
const initResult = await aiVulnDetection.initialize({
  dataStoragePath: './data/vulnerability-data',

  // Optional phase-specific configurations
  dataInfrastructure: {
    // Data infrastructure options
  },
  modelDevelopment: {
    // Model development options
  },
  testingIntegration: {
    // Testing integration options
  },
  advancedDetection: {
    // Advanced detection options
  },
  visualization: {
    // Visualization options
  },
});
```

### 2. Analyze Smart Contracts

```javascript
// Analyze a contract file
const analysisResult = await aiVulnDetection.analyzeContract({
  contractPath: './contracts/MyContract.sol',
});

// Or analyze code directly
const analysisResult = await aiVulnDetection.analyzeContract({
  contractCode: 'pragma solidity ^0.8.0; contract Example { ... }',
});
```

### 3. Collect Vulnerability Data

```javascript
// Collect data from contracts
const collectionResult = await aiVulnDetection.collectData({
  contracts: ['./contracts/Contract1.sol', './contracts/Contract2.sol'],
  contractDirectories: ['./contracts/collection1', './contracts/collection2'],
});

// Collect data from test results
const testResults = await aiVulnDetection.collectData({
  testResults: './test-results',
});
```

### 4. Train Models

```javascript
// Train a vulnerability detection model
const trainingResult = await aiVulnDetection.trainModel({
  modelId: 'vuln-classifier-base',
  datasetId: 'vulnerability-dataset-1',
  hyperparameterTuning: true,
  evaluateAfterTraining: true,
});
```

### 5. Integrate with Testing Frameworks

```javascript
// Create test hooks for Playwright
const testHooks = aiVulnDetection.createTestHooks({
  testFramework: 'playwright',
  saveDetectionResults: true,
  failOnCritical: true,
});

// Use in your test files
test('should handle secure transactions', async ({ page }) => {
  await testHooks.beforeTest({ title: 'secure-transaction-test' });

  // Your test code here
  await page.goto('https://example-dapp.com');

  // Before transaction hook
  await testHooks.beforeTransaction({
    to: '0x123...',
    value: '1000000000000000000',
    data: '0x...',
  });

  // Perform transaction
  await page.click('#send-transaction');

  // After test hook
  await testHooks.afterTest({ title: 'secure-transaction-test', status: 'passed' });
});
```

### 6. Generate Visualizations and Reports

```javascript
// Generate a vulnerability type visualization
const visualizationResult = await aiVulnDetection.generateVisualization({
  visualizationType: 'vulnerabilityTypes',
  vulnerabilityData: analysisResult,
  title: 'Vulnerability Type Distribution',
  format: 'html',
});

// Generate a comprehensive report
const reportResult = await aiVulnDetection.visualization.generateReport({
  vulnerabilityData: analysisResult,
  title: 'Smart Contract Security Report',
  description: 'Comprehensive security analysis',
  includeCharts: true,
  includeRemediation: true,
  format: 'html',
});
```

## Modules

### 1. Data Infrastructure

The Data Infrastructure module provides functionality for:

- Collecting and organizing vulnerability data
- Categorizing smart contracts
- Analyzing transaction patterns
- Aggregating test outcomes

```javascript
// Access module directly
const { dataInfrastructure } = aiVulnDetection;

// Initialize with specific options
await dataInfrastructure.initialize({
  datasetPath: './custom-dataset-path',
  contractStoragePath: './contract-storage',
});

// Categorize contracts
const categorization = await dataInfrastructure.smartContractCategorizer.categorizeContracts({
  contractDirectories: ['./contracts'],
});

// Collect test outcomes
const testOutcomes =
  await dataInfrastructure.testOutcomeAggregator.collectFromTests('./test-results');
```

### 2. Model Development

The Model Development module handles:

- Feature engineering for ML models
- Model training and evaluation
- Hyperparameter optimization
- Contract analysis using trained models

```javascript
// Access module directly
const { modelDevelopment } = aiVulnDetection;

// Train a model
const trainingResult = await modelDevelopment.trainModel({
  modelId: 'vulnerability-type-classifier',
  datasetId: 'vulnerability-dataset',
  hyperparameterTuning: true,
});

// Extract features from a contract
const features = await modelDevelopment.featureEngineering.extractFeatures({
  contractCode: contractSource,
  extractors: ['codeMetrics', 'patternMatches', 'semanticEmbeddings'],
});
```

### 3. Testing Integration

The Testing Integration module provides:

- Test hooks for various frameworks
- Vulnerability detection during tests
- Security alerting
- Test result processing

```javascript
// Access module directly
const { testingIntegration } = aiVulnDetection;

// Detect vulnerabilities
const detectionResult = await testingIntegration.detectVulnerabilities({
  contractCode: contractSource,
  transactionData: txData,
  testContext: {
    test: 'test-name',
    phase: 'beforeTransaction',
  },
});
```

### 4. Advanced Detection

The Advanced Detection module implements:

- Advanced vulnerability detection techniques
- Real-time monitoring
- Transaction pattern analysis
- Behavioral analysis

```javascript
// Access module directly
const { advancedDetection } = aiVulnDetection;

// Enhance analysis results
const enhancedAnalysis = await advancedDetection.enhanceAnalysis(analysisResult);

// Monitor a contract
const monitoringSetup = await advancedDetection.monitorContract({
  contractAddress: '0x123...',
  network: 'mainnet',
  monitoringDuration: 3600000, // 1 hour
});
```

### 5. Visualization

The Visualization module handles:

- Chart generation
- Report creation
- Data visualization
- Remediation recommendations

```javascript
// Access module directly
const { visualization } = aiVulnDetection;

// Generate report
const report = await visualization.generateReport({
  vulnerabilityData: analysisResult,
  title: 'Security Analysis',
  format: 'html',
  includeRemediation: true,
});
```

## Configuration

The system can be configured with a wide range of options:

```javascript
const config = {
  // System paths
  dataStoragePath: './data/vulnerability-data',

  // Data Infrastructure configuration
  dataInfrastructure: {
    datasetPath: null, // Will be set during initialization
    contractStoragePath: null, // Will be set during initialization
    vulnerabilityCategorization: [],
  },

  // Model Development configuration
  modelDevelopment: {
    modelStoragePath: null, // Will be set during initialization
    activeModels: {},
    featureEngineeringConfig: {
      codeMetrics: { enabled: true },
      patternMatches: { enabled: true },
      semanticEmbeddings: { enabled: true },
    },
  },

  // Testing Integration configuration
  testingIntegration: {
    testingStoragePath: null, // Will be set during initialization
    reportOutputPath: null, // Will be set during initialization
    testHooks: {
      beforeTest: true,
      afterTest: true,
      beforeTransaction: true,
    },
    alertingConfig: {
      enabled: true,
      failOnCritical: true,
    },
  },

  // Advanced Detection configuration
  advancedDetection: {
    detectionStoragePath: null, // Will be set during initialization
    realTimeDetection: true,
    detectionStrategies: ['pattern', 'anomaly', 'behavior'],
  },

  // Visualization configuration
  visualization: {
    visualizationStoragePath: null, // Will be set during initialization
    enabledVisualizations: ['vulnerabilityTypes', 'severityDistribution', 'timelineTrends'],
  },
};

await aiVulnDetection.initialize(config);
```

## Examples

See the [examples directory](../../examples/ai-vulnerability-detection-demo.js) for complete usage examples.

## License

This project is licensed under the MIT License - see the [LICENSE](../../LICENSE) file for details.
