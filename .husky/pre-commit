
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# Run ESLint
echo "üìù Checking code style with ESLint..."
npx eslint . --max-warnings=10 || {
  echo "‚ùå ESLint checks failed. Please fix the issues before committing."
  exit 1
}

# Run tests
echo "üß™ Running tests..."
npm test || {
  echo "‚ùå Tests failed. Please fix the failing tests before committing."
  exit 1
}

# Check for secrets
echo "üîê Scanning for secrets..."
if command -v trufflehog3 &> /dev/null; then
  trufflehog3 --format json . | jq '.[] | select(.rule.severity == "HIGH")' | head -5 && {
    echo "‚ùå High-severity secrets detected. Please remove them before committing."
    exit 1
  }
fi

echo "‚úÖ All pre-commit checks passed!"
